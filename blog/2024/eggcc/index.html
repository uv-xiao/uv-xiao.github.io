<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Look into eggcc | uv-xiao </title> <meta name="author" content="Youwei Xiao"> <meta name="description" content="struggling to be a good person. "> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-table@1.22.4/dist/bootstrap-table.min.css" integrity="sha256-uRX+PiRTR4ysKFRCykT8HLuRCub26LgXJZym3Yeom1c=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Indie+Flower:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link defer rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pseudocode@2.4.1/build/pseudocode.min.css" integrity="sha256-VwMV//xgBPDyRFVSOshhRhzJRDyBmIACniLPpeXNUdc=" crossorigin="anonymous"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://uv-xiao.github.io/blog/2024/eggcc/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> <link defer rel="stylesheet" type="text/css" href="https://tikzjax.com/v1/fonts.css"> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> uv-xiao </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">Blog </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Look into eggcc</h1> <p class="post-meta"> Created in December 01, 2024 </p> <p class="post-tags"> <a href="/blog/2024"> <i class="fa-solid fa-calendar fa-sm"></i> 2024 </a> </p> </header> <article class="post-content"> <div id="table-of-contents"> <ul id="toc" class="section-nav"> <li class="toc-entry toc-h1"> <a href="#eggcc">Eggcc</a> <ul> <li class="toc-entry toc-h2"><a href="#about">About</a></li> <li class="toc-entry toc-h2"><a href="#have-the-first-try">Have the first try</a></li> <li class="toc-entry toc-h2"> <a href="#how-to-develop">How to develop</a> <ul> <li class="toc-entry toc-h3"><a href="#setup-local-egglog-demo">Setup local egglog demo</a></li> <li class="toc-entry toc-h3"><a href="#install-vscode-extension">Install vscode extension</a></li> <li class="toc-entry toc-h3"> <a href="#add-new-rulesets">Add new rulesets</a> <ul> <li class="toc-entry toc-h4"><a href="#make-it-more-accessible">Make it more accessible</a></li> </ul> </li> </ul> </li> <li class="toc-entry toc-h2"> <a href="#how-it-works">How it works</a> <ul> <li class="toc-entry toc-h3"><a href="#rvsdg">RVSDG</a></li> <li class="toc-entry toc-h3"><a href="#dag">DAG</a></li> <li class="toc-entry toc-h3"><a href="#egglog">Egglog</a></li> <li class="toc-entry toc-h3"> <a href="#checking-and-optimization">Checking and Optimization</a> <ul> <li class="toc-entry toc-h5"><a href="#legality-checking">Legality Checking</a></li> <li class="toc-entry toc-h5"><a href="#type-analysis">Type Analysis</a></li> <li class="toc-entry toc-h5"><a href="#add-context">Add Context</a></li> <li class="toc-entry toc-h5"><a href="#term-substitution">Term Substitution</a></li> <li class="toc-entry toc-h5"><a href="#substitution">Substitution</a></li> <li class="toc-entry toc-h5"><a href="#drop">Drop</a></li> <li class="toc-entry toc-h5"><a href="#interval-analysis-and-rewrite">Interval Analysis and Rewrite</a></li> <li class="toc-entry toc-h5"><a href="#switch-rewrite">Switch Rewrite</a></li> <li class="toc-entry toc-h5"><a href="#select-optimization">Select Optimization</a></li> <li class="toc-entry toc-h5"><a href="#peepholes">Peepholes</a></li> <li class="toc-entry toc-h5"><a href="#pointee">Pointee</a></li> <li class="toc-entry toc-h5"><a href="#invariant-analysis">Invariant Analysis</a></li> <li class="toc-entry toc-h5"><a href="#boundary-analysis">Boundary Analysis</a></li> <li class="toc-entry toc-h5"><a href="#loop-optimization">Loop Optimization</a></li> </ul> </li> </ul> </li> </ul> </li> </ul> </div> <hr> <div id="markdown-content"> <h1 id="eggcc">Eggcc</h1> <blockquote class="block-tip"> <p>I’m trying to use e-graph/eqsat/extract/… to do some compiler-involved stuff. The <a href="https://github.com/egraphs-good/eggcc" rel="external nofollow noopener" target="_blank">eggcc</a> is a good starting point. And here is my note of it.</p> </blockquote> <h2 id="about">About</h2> <p><a href="https://github.com/egraphs-good/eggcc" rel="external nofollow noopener" target="_blank">eggcc</a> compiles <a href="https://github.com/uwplse/bril" rel="external nofollow noopener" target="_blank">bril</a> to LLVMIR/cranelift. It is mainly hosted by UW PLSE lab (I guess, since the active contributors, including Oliver Flatt, Anjali Pal, and Yihong Zhang, are from the lab). The project is still under heavy development, and lacks open documentation. I found it very inspiring as a rewrite-based, more specifically <a href="https://github.com/egraphs-good/egglog" rel="external nofollow noopener" target="_blank">egglog</a>-based compiler. So here is my note of it.</p> <p>Related work:</p> <ul> <li> <a href="https://github.com/phate/jlm" rel="external nofollow noopener" target="_blank">jlm</a>: <code class="language-plaintext highlighter-rouge">RVSDG</code>-based compiler: <code class="language-plaintext highlighter-rouge">llvmir -&gt; RVSDG -&gt; llvmir/mlir/circt</code>;</li> <li> <a href="https://github.com/jameysharp/optir/" rel="external nofollow noopener" target="_blank">optir</a>: proof-of-concept <code class="language-plaintext highlighter-rouge">RVSDG</code>-based compiler, use <a href="https://github.com/egraphs-good/egg" rel="external nofollow noopener" target="_blank">egg</a> for optimization;</li> </ul> <h2 id="have-the-first-try">Have the first try</h2> <blockquote class="block-tip"> <p>words to my colleague: please use my fork of eggcc, which is <a href="https://github.com/uv-xiao/eggcc" rel="external nofollow noopener" target="_blank">uv-xiao/eggcc</a>.</p> </blockquote> <p>Follow <a href="https://github.com/egraphs-good/eggcc" rel="external nofollow noopener" target="_blank">eggcc’s README</a>’s instruction for installation (which should be fine <img class="emoji" title=":smiley:" alt=":smiley:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f603.png" height="20" width="20">), then run:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cargo run -- --debug-dir ./temp --run-mode optimize  &lt;bril, e.g. ./tests/passing/small/loop_if.bril&gt; 
</code></pre></div></div> <p>Then, <a href="https://github.com/egraphs-good/eggcc" rel="external nofollow noopener" target="_blank">eggcc</a> will generate the <code class="language-plaintext highlighter-rouge">temp</code> directory, holding some visualization files for <code class="language-plaintext highlighter-rouge">rvsdg</code>, <code class="language-plaintext highlighter-rouge">cfg</code>, and <code class="language-plaintext highlighter-rouge">dag</code>. And the optimized <code class="language-plaintext highlighter-rouge">bril</code> code will be printed to stdout.</p> <p><del>Also, you can run (after some npm setup):</del></p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bash infra/localnightly.sh &lt;bril file or directory&gt;
cd nightly/output &amp;&amp; python3 -m http.server
</code></pre></div></div> <p><del>to get a local server for report and visualization of <code class="language-plaintext highlighter-rouge">eggcc</code>’s runs.</del></p> <blockquote class="block-tip"> <p>seems not useful for us</p> </blockquote> <h2 id="how-to-develop">How to develop</h2> <h3 id="setup-local-egglog-demo">Setup local egglog demo</h3> <p>After clone eggcc (maybe from <a href="https://github.com/uv-xiao/eggcc" rel="external nofollow noopener" target="_blank">my fork</a>), you’d better also clone the <a href="https://github.com/egraphs-good/egglog" rel="external nofollow noopener" target="_blank">egglog</a> repo and checkout to the commit used by eggcc.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone git@github.com:egraphs-good/egglog.git
<span class="nb">cd </span>egglog
git checkout 246b195 <span class="c"># make sure the commit is the same as eggcc!</span>
</code></pre></div></div> <p>Then, you can start the egglog web-demo locally (you may need some proxy setting for fast installation):</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cargo <span class="nb">install </span>cargo-watch wasm-pack
make serve <span class="c"># it can be slow for the first time</span>
<span class="c"># if make serve failed, tab Ctrl-c to stop, and run `make serve` again</span>
</code></pre></div></div> <p>Then you can open the <code class="language-plaintext highlighter-rouge">http://localhost:8080/</code> in your browser.</p> <p>You can also install <code class="language-plaintext highlighter-rouge">egglog</code> locally:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># under egglog directory</span>
cargo <span class="nb">install</span> <span class="nt">--path</span> <span class="nb">.</span> <span class="nt">--root</span> &lt;path-to-install, like <span class="nv">$HOME</span>/.local&gt;
</code></pre></div></div> <p>After, you can run <code class="language-plaintext highlighter-rouge">egglog --to-dot &lt;path-to-egglog-program&gt;</code> to get the dot file.</p> <h3 id="install-vscode-extension">Install vscode extension</h3> <p>named <code class="language-plaintext highlighter-rouge">egglog-language</code></p> <h3 id="add-new-rulesets">Add new rulesets</h3> <p>Take a look at the <code class="language-plaintext highlighter-rouge">peepholes</code> ruleset in <code class="language-plaintext highlighter-rouge">dag_in_context/src/optimizations/peepholes.rs</code> and <code class="language-plaintext highlighter-rouge">dag_in_context/src/optimizations/peepholes.egg</code> for example;</p> <p>In the <code class="language-plaintext highlighter-rouge">arith_rewrites</code> test function, it first create <code class="language-plaintext highlighter-rouge">expr: Rc&lt;Expr&gt;</code>, representing <code class="language-plaintext highlighter-rouge">(0 + x + 0 + 1 + 2 + y * 1)</code>. The expected output <code class="language-plaintext highlighter-rouge">expected: Rc&lt;Expr&gt;</code> is <code class="language-plaintext highlighter-rouge">(x + 3 + y)</code>. And the test calls <code class="language-plaintext highlighter-rouge">egglog_test()</code>, which includes:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>; eggcc prologue, thousands of lines
(let expr_ {expr}) ; build expr_ from expr
; run eggcc schedule
(check (= expr_ {expected})) ; check if the expected output is derived
</code></pre></div></div> <p>Then, you can run the test:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cargo test -p dag_in_context -- optimizations::peepholes::arith_rewrites --exact --show-output
</code></pre></div></div> <p>where <code class="language-plaintext highlighter-rouge">optimizations::peepholes::arith_rewrites</code> is the path to the test function. <code class="language-plaintext highlighter-rouge">--exact</code> is used to match the exact function name, and <code class="language-plaintext highlighter-rouge">--show-output</code> is used to show the output of the test.</p> <p>The stdout will contain:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Writing egglog test to &lt;path-to-eggcc&gt;/dag_in_context/temp/egglog_test.egg
</code></pre></div></div> <p>which contains thousands of lines.</p> <p>In <code class="language-plaintext highlighter-rouge">dag_in_context/src/lib.rs</code>, you can check the <code class="language-plaintext highlighter-rouge">egglog_test_internal</code> to see how the egglog program is generated:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  let program = format!(
    ";Here is the &lt;PROLOGUE&gt;\n{}\n\n;Here is the &lt;BUILD&gt;\n{build}\n\n;Here is the &lt;SCHEDULE&gt;\n{}\n\n;Here is the &lt;CHECK&gt;\n{check}\n",
    reduce_redundant_nlines(prologue()),
    reduce_redundant_nlines(
      parallel_schedule()
        .iter()
        .map(|pass| pass.egglog_schedule().to_string())
        .collect::&lt;Vec&lt;String&gt;&gt;()
        .join("\n")
    ),
  );
</code></pre></div></div> <p>And you can search for <code class="language-plaintext highlighter-rouge">;Here is the &lt;BUILD&gt;</code> to find the original <code class="language-plaintext highlighter-rouge">expr</code>, and <code class="language-plaintext highlighter-rouge">;Here is the &lt;CHECK&gt;</code> to find the expected output.</p> <blockquote class="block-tip"> <p>The <code class="language-plaintext highlighter-rouge">interpret</code> feature of eggcc is also useful for debugging. Currently, I’ve not used it. This is a TODO.</p> </blockquote> <p>Now, you can paste the egglog program to the local egglog demo, and see if the expected output is derived.</p> <p>You can use the <code class="language-plaintext highlighter-rouge">Slidemode</code> to inspect the egglog execution step by step.</p> <h4 id="make-it-more-accessible">Make it more accessible</h4> <p>Currently, the egglog program is not accessible. IT’S TOO LONG! And the <code class="language-plaintext highlighter-rouge">schedule</code>s do too much things.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>prologue lines: 4703
schedule lines: 497
</code></pre></div></div> <p>And the produced graphviz file contains too many nodes and edges (2362 lines).</p> <p>So, we may make them simpler.</p> <ol> <li>apply <code class="language-plaintext highlighter-rouge">debug-deletes</code> ruleset for simplified visualization; <div class="language-plaintext highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>  (run-schedule debug-deletes) ; after &lt;CHECK&gt;
</code></pre></div> </div> <p>for the <code class="language-plaintext highlighter-rouge">peepholes::arith_rewrites</code> test, the dot file lines reduce to 1743 lines, much more readable.</p> </li> <li>…</li> </ol> <blockquote class="block-tip"> <p>TODO: simplify prologue and schedule.</p> </blockquote> <h2 id="how-it-works">How it works</h2> <p>Main loop: in <code class="language-plaintext highlighter-rouge">src/utils.rs</code>, <code class="language-plaintext highlighter-rouge">Run::optimize_bril</code>:</p> <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">fn</span> <span class="nf">optimize_bril</span><span class="p">(</span><span class="n">program</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">Program</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">EggccConfig</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Result</span><span class="o">&lt;</span><span class="n">Program</span><span class="p">,</span> <span class="n">EggCCError</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="k">let</span> <span class="n">rvsdg</span> <span class="o">=</span> <span class="nn">Optimizer</span><span class="p">::</span><span class="nf">program_to_rvsdg</span><span class="p">(</span><span class="n">program</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
  <span class="k">let</span> <span class="p">(</span><span class="n">dag</span><span class="p">,</span> <span class="k">mut</span> <span class="n">cache</span><span class="p">)</span> <span class="o">=</span> <span class="n">rvsdg</span><span class="nf">.to_dag_encoding</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
  <span class="k">let</span> <span class="n">optimized</span> <span class="o">=</span>
      <span class="nn">dag_in_context</span><span class="p">::</span><span class="nf">optimize</span><span class="p">(</span><span class="o">&amp;</span><span class="n">dag</span><span class="p">,</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">cache</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span><span class="nf">.map_err</span><span class="p">(</span><span class="nn">EggCCError</span><span class="p">::</span><span class="n">EggLog</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
  <span class="k">let</span> <span class="n">rvsdg2</span> <span class="o">=</span> <span class="nf">dag_to_rvsdg</span><span class="p">(</span><span class="o">&amp;</span><span class="n">optimized</span><span class="p">);</span>
  <span class="k">let</span> <span class="n">cfg</span> <span class="o">=</span> <span class="n">rvsdg2</span><span class="nf">.to_cfg</span><span class="p">();</span>
  <span class="k">let</span> <span class="n">bril</span> <span class="o">=</span> <span class="n">cfg</span><span class="nf">.to_bril</span><span class="p">();</span>
  <span class="k">let</span> <span class="n">bril</span> <span class="o">=</span> <span class="nf">canonicalize_bril</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bril</span><span class="p">);</span>
  <span class="nf">Ok</span><span class="p">(</span><span class="n">bril</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="rvsdg">RVSDG</h3> <p>In <code class="language-plaintext highlighter-rouge">src/rvsdg/mod.rs</code>:</p> <table> <thead> <tr> <th>struct/enum</th> <th>description</th> <th>members</th> </tr> </thead> <tbody> <tr> <td><code class="language-plaintext highlighter-rouge">BasicExpr</code></td> <td>prim op, function call, const, effect (mem, print)</td> <td>operands: <code class="language-plaintext highlighter-rouge">Vec&lt;Op&gt;</code> </td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">Operand</code></td> <td>region arg, region output</td> <td>i-th arg/output, region <code class="language-plaintext highlighter-rouge">Id</code> </td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">RvsdgBody</code></td> <td>basic, if (0/1), gamma (switch), theta (do-while)</td> <td>holding <code class="language-plaintext highlighter-rouge">Operand</code>s</td> </tr> </tbody> </table> <p><code class="language-plaintext highlighter-rouge">rvsdg</code> format is imagelike, exprs and bodies are nodes, operands are edges.</p> <p>For example, <a href="https://github.com/egraphs-good/eggcc/blob/main/tests/passing/small/min.bril" rel="external nofollow noopener" target="_blank">min.bril</a>:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># ARGS: 20 30
@main(x: int, y: int) {
  cmp: bool = lt x y;
  res: int = id y;
  br cmp .then .else;
  .then:
    res: int = id x;
  .else:
  .done:
    print res;
}
</code></pre></div></div> <p>corresponds to two rvsdgs:</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/in_posts/2024-12-01-eggcc-rvsdg-480.webp 480w,/assets/img/in_posts/2024-12-01-eggcc-rvsdg-800.webp 800w,/assets/img/in_posts/2024-12-01-eggcc-rvsdg-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/in_posts/2024-12-01-eggcc-rvsdg.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/in_posts/2024-12-01-eggcc-rvsdg-optmized-480.webp 480w,/assets/img/in_posts/2024-12-01-eggcc-rvsdg-optmized-800.webp 800w,/assets/img/in_posts/2024-12-01-eggcc-rvsdg-optmized-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/in_posts/2024-12-01-eggcc-rvsdg-optmized.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> unoptimized/optimized rvsdg </div> <h3 id="dag">DAG</h3> <p><code class="language-plaintext highlighter-rouge">rvsdg-&gt;dag</code>: in <code class="language-plaintext highlighter-rouge">src/rvsdg/to_dag.rs</code>, <code class="language-plaintext highlighter-rouge">RvsdgProgram::to_dag_encoding</code></p> <p><code class="language-plaintext highlighter-rouge">dag</code>: in <code class="language-plaintext highlighter-rouge">dag_in_context/schema.rs</code></p> <p>The <code class="language-plaintext highlighter-rouge">dag</code> format is a graph of expressions with contexts:</p> <table> <thead> <tr> <th>struct/enum</th> <th>description</th> <th>members</th> </tr> </thead> <tbody> <tr> <td><code class="language-plaintext highlighter-rouge">TreeProgram</code></td> <td>program</td> <td>entry, functions</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">Expr</code></td> <td>expression, including func, loop, expr, …</td> <td> <code class="language-plaintext highlighter-rouge">RcExpr</code> as operands and results</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">RcExpr</code></td> <td>expression as data</td> <td><code class="language-plaintext highlighter-rouge">Rc&lt;Expr&gt;</code></td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">Assumption</code></td> <td>context, in-loop, in-if, …</td> <td>directly bound to consts, and args</td> </tr> </tbody> </table> <blockquote> <p>For more details about <code class="language-plaintext highlighter-rouge">Assumption</code>, see <code class="language-plaintext highlighter-rouge">ASSUME</code> nodes in “Automating Constraint-Aware Datapath Optimization using E-Graphs. DAC 2023, doi: 10.1109/DAC56929.2023.0247797”.</p> </blockquote> <p><a href="https://github.com/egraphs-good/eggcc/blob/main/tests/passing/small/min.bril" rel="external nofollow noopener" target="_blank">min.bril</a>’s unoptimized rvsdg is converted to:</p> <div class="row mt-1"> <div class="col-sm mt-1 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/in_posts/2024-12-01-eggcc-dag-480.webp 480w,/assets/img/in_posts/2024-12-01-eggcc-dag-800.webp 800w,/assets/img/in_posts/2024-12-01-eggcc-dag-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/in_posts/2024-12-01-eggcc-dag.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> unoptimized dag </div> <h3 id="egglog">Egglog</h3> <p><code class="language-plaintext highlighter-rouge">dag-&gt;egglog</code>: in <code class="language-plaintext highlighter-rouge">dag_in_context/to_egglog.rs</code>, <code class="language-plaintext highlighter-rouge">TreeToEgglog</code>:</p> <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">pub</span><span class="p">(</span><span class="k">crate</span><span class="p">)</span> <span class="k">struct</span> <span class="n">TreeToEgglog</span> <span class="p">{</span>
    <span class="k">pub</span> <span class="n">termdag</span><span class="p">:</span> <span class="n">TermDag</span><span class="p">,</span>
    <span class="c1">// Cache for shared subexpressions</span>
    <span class="n">converted_cache</span><span class="p">:</span> <span class="n">IndexMap</span><span class="o">&lt;*</span><span class="k">const</span> <span class="n">Expr</span><span class="p">,</span> <span class="n">Term</span><span class="o">&gt;</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div></div> <p>, where <code class="language-plaintext highlighter-rouge">TermDag</code> is hashconsing arena for <code class="language-plaintext highlighter-rouge">Term</code>s provided by <code class="language-plaintext highlighter-rouge">egglog</code>.</p> <p><code class="language-plaintext highlighter-rouge">dag-&gt;egglog</code> is very straightforward: for an <code class="language-plaintext highlighter-rouge">Expr</code>, such as an <code class="language-plaintext highlighter-rouge">Expr::Bop(op, lhs, rhs)</code>, it is converted to something like <code class="language-plaintext highlighter-rouge">(Bop (op) (lhs) (rhs))</code> in egglog.</p> <p>The generated egglog is very verbose. The <a href="https://github.com/egraphs-good/eggcc/blob/main/tests/passing/small/min.bril" rel="external nofollow noopener" target="_blank">min.bril</a>’s egglog is 4000+ lines. Here I introduce the contents briefly:</p> <blockquote> <p>THESE DEFINITIONS ARE ALL THE SAME FOR EVERY BRIL PROGRAM.</p> </blockquote> <ul> <li> <code class="language-plaintext highlighter-rouge">Term</code>: <code class="language-plaintext highlighter-rouge">Expr | ListExpr</code> </li> <li>data type: <div class="language-plaintext highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>(datatype BaseType
  (IntT) (BoolT) (FloatT)
  ; a pointer to a memory region with a particular type
  (PointerT BaseType)
  (StateT))
(datatype Type
  ; a primitive type
  (Base BaseType)
  ; a typed tuple. Use an empty tuple as a unit type.
  ; state edge also has unit type
  ; function TNil and TCons produces TypeList
  (TupleT TypeList)
)
</code></pre></div> </div> </li> <li><code class="language-plaintext highlighter-rouge">Assumption: InFunc | InLoop | InIf | InSwitch</code></li> <li>Leaf nodes: <div class="language-plaintext highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>(function Arg (Type Assumption) Expr)
(function Const (Constant Type Assumption) Expr)
(function Empty (Type Assumption) Expr)
</code></pre></div> </div> </li> <li>Operators: <code class="language-plaintext highlighter-rouge">TernaryOp</code>, <code class="language-plaintext highlighter-rouge">BinaryOp</code>, <code class="language-plaintext highlighter-rouge">UnaryOp</code> <div class="language-plaintext highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>(function Top   (TernaryOp Expr Expr Expr) Expr)
(function Bop   (BinaryOp Expr Expr) Expr)
(function Uop   (UnaryOp Expr) Expr)
; some other about tuple, alloc, call
</code></pre></div> </div> </li> <li>Control flow: if, switch, loop <div class="language-plaintext highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>; Switch on a list of lazily-evaluated branches.
; pred must be an integer
;                 pred  inputs   branches     chosen
(function Switch (Expr  Expr     ListExpr)    Expr)
; If is like switch, but with a boolean predicate
;             pred inputs   then else
(function If (Expr Expr     Expr Expr) Expr)
; A do-while loop.
; Evaluates the input, then evaluates the body.
; input must have the same type as (output1, output2, ..., outputi)
; input must be a tuple, pred must be a boolean
; pred-and-body must be a flat tuple (pred, out1, out2, ..., outi)
; input must be the same type as (out1, out2, ..., outi)
;                  input   pred-and-body
(function DoWhile (Expr    Expr)                   Expr)
</code></pre></div> </div> </li> </ul> <p>Generated egglog also have <code class="language-plaintext highlighter-rouge">Term</code>s.</p> <blockquote class="block-tip"> <p>why need <code class="language-plaintext highlighter-rouge">Term</code>? It looks like <code class="language-plaintext highlighter-rouge">Expr</code>… Its usage need to be clarified.</p> </blockquote> <p>It defines and infers the sort <code class="language-plaintext highlighter-rouge">TermAndCost</code> and the function <code class="language-plaintext highlighter-rouge">ExtractedExpr</code> for cost-model-guided extraction? So <code class="language-plaintext highlighter-rouge">Term</code> is extracted <code class="language-plaintext highlighter-rouge">Expr</code>? See the <a href="#select-optimization">select optimization</a> example, it seems so.</p> <p>The <code class="language-plaintext highlighter-rouge">term-subst</code> ruleset instantiates the term as an Expr in the provided context.</p> <h3 id="checking-and-optimization">Checking and Optimization</h3> <blockquote class="block-warning"> <p>not finished yet; this relates to compiler optimization, maybe out of our concern.</p> </blockquote> <h5 id="legality-checking">Legality Checking</h5> <p>Implemented in rulesets:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(ruleset is-resolved)
(ruleset always-run) 
</code></pre></div></div> <h5 id="type-analysis">Type Analysis</h5> <p>Implemented in rulesets:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(ruleset type-analysis)
(ruleset type-helpers) 
</code></pre></div></div> <p>It interfers relations:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>;; Keep track of type expectations for error messages
(relation ExpectType (Expr Type String))
</code></pre></div></div> <p>and type-checking rules is like:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(rule (
        (ExpectType e expected msg)
        (HasType e actual)
        (!= expected actual) ;; not okay unless we saturate type helpers.
      )
      ((extract "Expecting expression")
       (extract e)
       (extract "to have type")
       (extract expected)
       (extract "but got type")
       (extract actual)
       (extract "with message")
       (extract msg)
       (panic "type mismatch- check RUST_LOG=info for expressions that mismatched"))
      :ruleset error-checking)
</code></pre></div></div> <p>and also have rules to infer and check <code class="language-plaintext highlighter-rouge">HasArgType</code> and <code class="language-plaintext highlighter-rouge">HasType</code> relations for operators and control flow nodes.</p> <h5 id="add-context">Add Context</h5> <p>Implemented in ruleset:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(ruleset context)
</code></pre></div></div> <h5 id="term-substitution">Term Substitution</h5> <blockquote class="block-tip"> <p>when is this used?</p> </blockquote> <p>Implemented in ruleset:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(ruleset term-subst)
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>; Instantiate the term as an Expr in the provided context
; where references to (Arg) in the term are replaced by Expr
(function TermSubst (Assumption Expr Term) Expr :unextractable)
</code></pre></div></div> <p>For the example of an constant term:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>; replace the context
(rule ((= lhs (TermSubst ctx e (TermArg))))
      ((union lhs (AddContext ctx e)))
      :ruleset term-subst)
</code></pre></div></div> <h5 id="substitution">Substitution</h5> <p>Implemented in rulesets:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>;; Substitution rules allow for substituting some new expression for the argument
;; in some new context.
;; It performs the substitution, copying over the equalities from the original eclass.
;; It only places context on the leaf nodes.

(ruleset subst)
(ruleset apply-subst-unions)
(ruleset cleanup-subst)
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>;; (Subst assumption to in) substitutes `to` for `(Arg ty)` in `in`.
;; It also replaces the leaf context in `to` with `assumption` using `AddContext`.
;; `assumption` *justifies* this substitution, as the context that the result is used in.
;; In other words, it must refine the equivalence relation of `in` with `to` as the argument.
;;                          to   in
(function Subst (Assumption Expr Expr) Expr :unextractable)

;; Used to delay unions for the subst ruleset.
;; This is necessary because substitution may not terminate if it can
;; observe its own results- it may create infinitly large terms.
;; Instead, we phase substitution by delaying resulting unions in this table.
;; After applying this table, substitutions and this table are cleared.
(function DelayedSubstUnion (Expr Expr) Expr :unextractable)
</code></pre></div></div> <p>The apply is multi-phase:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(rule ((= lhs (Subst assum to (Arg _ty _oldctx)))
       )
      ;; add the assumption `to`
      ((DelayedSubstUnion lhs (AddContext assum to))))
</code></pre></div></div> <p>after registering the delayed unions:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(rule ((DelayedSubstUnion lhs rhs))
      ((union lhs rhs))
      :ruleset apply-subst-unions)
</code></pre></div></div> <h5 id="drop">Drop</h5> <h5 id="interval-analysis-and-rewrite">Interval Analysis and Rewrite</h5> <p>Implemented in ruleset:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(ruleset interval-analysis)
(ruleset interval-rewrite)
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>; if the predicate is true, merge with then branch
(rule (
       (= lhs (If cond inputs thn els))
       (ContextOf lhs if_ctx)
       (= (BoolB true) (lo-bound cond))
      )
      ((union lhs (Subst if_ctx inputs thn)))
      :ruleset interval-rewrite)
</code></pre></div></div> <h5 id="switch-rewrite">Switch Rewrite</h5> <p>Implemented in ruleset:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(ruleset switch_rewrite)
(ruleset always-switch-rewrite)
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>; if a &lt; b then a else b ~~&gt; (min a b)
(rule (
       (= pred (Bop (LessThan) a b))
       (= if_e (If pred inputs thn els))
       ; a is an input to the if region
       (= a (Get inputs i))
       ; b is an input to the if region
       (= b (Get inputs j))
       ; if a &lt; b then a else b
       (= (Get thn k) (Get (Arg ty (InIf true pred inputs)) i))
       (= (Get els k) (Get (Arg ty (InIf false pred inputs)) j))
      )
      ((union (Get if_e k) (Bop (Smin) a b)))
      :ruleset switch_rewrite)
</code></pre></div></div> <h5 id="select-optimization">Select Optimization</h5> <p>Implemented in ruleset:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(ruleset select_opt)
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(rule
       (
        (= if_e (If pred inputs thn els))
        (ContextOf if_e ctx)

        (= thn_out (Get thn i))
        (= els_out (Get els i))
        (ExprIsPure thn_out)
        (ExprIsPure els_out)
        
        (&gt; 10 (Expr-size thn_out)) ; TODO: Tune these size limits
        (&gt; 10 (Expr-size els_out))
        (= (TCPair t1 c1) (ExtractedExpr thn_out))
        (= (TCPair t2 c2) (ExtractedExpr els_out))
       )
       (
        (union (Get if_e i)
               (Top (Select) pred (TermSubst ctx inputs t1) (TermSubst ctx inputs t2)))
       )
       :ruleset select_opt
)
</code></pre></div></div> <p>This is a intuitive example for using <code class="language-plaintext highlighter-rouge">TermSubst</code> (<a href="#term-substitution">Term Substitution</a>).</p> <h5 id="peepholes">Peepholes</h5> <p>Implemented in ruleset:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(ruleset peephole)
</code></pre></div></div> <p>Example:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(rewrite (Bop (Mul) (Const (Int 0) ty ctx) e) (Const (Int 0) ty ctx) :ruleset peepholes)
</code></pre></div></div> <h5 id="pointee">Pointee</h5> <p>Implemented in ruleset:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(ruleset memory-helpers)
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(datatype PtrPointees
  (PointsTo List&lt;i64+IntInterval&gt;)
  (PointsAnywhere))

; List&lt;i64+IntInterval&gt; is used as an association list; the i64 keys
; (corresponding to alloc ids) are always unique and sorted, the IntInterval
; values correspond to offset ranges.
; PtrPointees 
;
; (TuplePointsTo [{0-&gt;[4,5], 1-&gt;[0,0]}, {0-&gt;[0,0]}])
; indicates a tuple with two components.
; - The first component might point to Alloc 0 at offsets 4 or 5,
;   or Alloc 1 at offset 0
; - The second component points to Alloc 0 at offset 0
(datatype Pointees
          (TuplePointsTo List&lt;PtrPointees&gt;)
          (PtrPointsTo PtrPointees))
</code></pre></div></div> <p>Here’s a link to the related PR: <a href="https://github.com/egraphs-good/eggcc/pull/434#issue-2228859498" rel="external nofollow noopener" target="_blank">Pointer Analysis</a>, where it says:</p> <ul> <li> <code class="language-plaintext highlighter-rouge">PtrPointees</code> represents where a single pointer can point;</li> <li> <code class="language-plaintext highlighter-rouge">Pointees</code> represents where an Expr can point to.</li> </ul> <p>As an example: <code class="language-plaintext highlighter-rouge">(TuplePointsTo [(PointsTo {0-&gt;[4,5], 1-&gt;[0,0]}), (PointsAnywhere)])</code> indicates a tuple with two components:</p> <ul> <li>The first component might point to Alloc 0 at offset 4 or 5 or Alloc 1 at offset 0.</li> <li>The second component might point anywhere.</li> </ul> <p>The key function of the pointer analysis is:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(function PointsToCells (Expr Pointees) Pointees)
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">(= pointees (PointsToCells e arg-pointees))</code> indicates that when the <code class="language-plaintext highlighter-rouge">(Arg)</code> contained in <code class="language-plaintext highlighter-rouge">e</code> points to <code class="language-plaintext highlighter-rouge">arg-pointees</code>, <code class="language-plaintext highlighter-rouge">e</code> points to <code class="language-plaintext highlighter-rouge">pointees</code>.</p> <blockquote class="block-warning"> <p>don’t understand this…</p> </blockquote> <p>why?</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(rule ((PointsToCells (Bop (Load) e state) ap))
      ((PointsToCells e ap)
       (PointsToCells state ap))
      :ruleset memory-helpers)
</code></pre></div></div> <h5 id="invariant-analysis">Invariant Analysis</h5> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>;; bool: whether the term in the Expr is an invariant.
(function is-inv-Expr (Expr Expr) bool :unextractable :merge (or old new))
(function is-inv-ListExpr (Expr ListExpr) bool :unextractable :merge (or old new))
</code></pre></div></div> <h5 id="boundary-analysis">Boundary Analysis</h5> <p>Implemented in ruleset:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(ruleset boundary-analysis)
</code></pre></div></div> <h5 id="loop-optimization">Loop Optimization</h5> <p>Implemented in ruleset:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(ruleset loop-unroll)
(ruleset loop-peel)
(ruleset loop-iters-analysis)
</code></pre></div></div> </div> </article> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2024 Youwei Xiao. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Last updated: December 09, 2024. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/mermaid@10.7.0/dist/mermaid.min.js" integrity="sha256-TtLOdUA8mstPoO6sGvHIGx2ceXrrX4KgIItO06XOn8A=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/d3@7.8.5/dist/d3.min.js" integrity="sha256-1rA678n2xEx7x4cTZ5x4wpUCj6kUMZEZ5cxLSVSFWxw=" crossorigin="anonymous"></script> <script>let mermaidTheme=determineComputedTheme();document.addEventListener("readystatechange",()=>{"complete"===document.readyState&&(document.querySelectorAll("pre>code.language-mermaid").forEach(e=>{const t=e.textContent,d=e.parentElement;d.classList.add("unloaded");let a=document.createElement("pre");a.classList.add("mermaid");const n=document.createTextNode(t);a.appendChild(n),d.after(a)}),mermaid.initialize({theme:mermaidTheme}),"undefined"!=typeof d3&&window.addEventListener("load",function(){d3.selectAll(".mermaid svg").each(function(){var e=d3.select(this);e.html("<g>"+e.html()+"</g>");var t=e.select("g"),d=d3.zoom().on("zoom",function(e){t.attr("transform",e.transform)});e.call(d)})}))});</script> <script defer src="https://tikzjax.com/v1/tikzjax.js" integrity="sha256-+1qyucCXRZJrCg3lm3KxRt/7WXaYhBid4/1XJRHGB1E=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script defer src="https://cdn.jsdelivr.net/npm/bootstrap-table@1.22.4/dist/bootstrap-table.min.js" integrity="sha256-4rppopQE9POKfukn2kEvhJ9Um25Cf6+IDVkARD0xh78=" crossorigin="anonymous"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0,processEnvironments:!0}};</script> <script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/pseudocode@2.4.1/build/pseudocode.min.js" integrity="sha256-aVkDxqyzrB+ExUsOY9PdyelkDhn/DfrjWu08aVpqNlo=" crossorigin="anonymous"></script> <script>document.addEventListener("readystatechange",()=>{"complete"===document.readyState&&document.querySelectorAll("pre>code.language-pseudocode").forEach(e=>{const t=e.textContent,d=e.parentElement.parentElement;let n=document.createElement("pre");n.classList.add("pseudocode");const o=document.createTextNode(t);n.appendChild(o),d.appendChild(n),d.removeChild(e.parentElement),pseudocode.renderElement(n)})});</script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> <script src="/assets/js/tabs.min.js?b8748955e1076bbe0dabcf28f2549fdc"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>addBackToTop();</script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script>let searchTheme=determineComputedTheme();const ninjaKeys=document.querySelector("ninja-keys");"dark"===searchTheme?ninjaKeys.classList.add("dark"):ninjaKeys.classList.remove("dark");const openSearchModal=()=>{const e=$("#navbarNav");e.hasClass("show")&&e.collapse("hide"),ninjaKeys.open()};</script> <script>const ninja=document.querySelector("ninja-keys");ninja.data=[{id:"nav-about",title:"About",section:"Navigation",handler:()=>{window.location.href="/"}},{id:"nav-blog",title:"Blog",description:"",section:"Navigation",handler:()=>{window.location.href="/blog/"}},{id:"post-look-into-eggcc",title:"Look into eggcc",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/eggcc/"}},{id:"post-learn-e-graph-egg-and-more",title:"Learn e-graph, egg, and more",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/egg-things/"}},{id:"post-zsim-swarm",title:"zSim + Swarm",description:"note down some tries, thoughts, and questions about zSim and Swarm",section:"Posts",handler:()=>{window.location.href="/blog/2024/zsim/"}},{id:"post-supported-features",title:"Supported Features",description:"this is what features are supported in posts",section:"Posts",handler:()=>{window.location.href="/blog/2024/features/"}},{id:"socials-email",title:"Send email",section:"Socials",handler:()=>{window.open("mailto:%73%68%61%6C%6C%77%65%78%69%61%6F@%67%6D%61%69%6C.%63%6F%6D","_blank")}},{id:"socials-github",title:"GitHub",section:"Socials",handler:()=>{window.open("https://github.com/uv-xiao","_blank")}},{id:"socials-x",title:"X",description:"Twitter",section:"Socials",handler:()=>{window.open("https://twitter.com/youwei_xiao","_blank")}},{id:"socials-rss",title:"RSS Feed",section:"Socials",handler:()=>{window.open("/feed.xml","_blank")}},{id:"light-theme",title:"Change theme to light",description:"Change the theme of the site to Light",section:"Theme",handler:()=>{setThemeSetting("light")}},{id:"dark-theme",title:"Change theme to dark",description:"Change the theme of the site to Dark",section:"Theme",handler:()=>{setThemeSetting("dark")}},{id:"system-theme",title:"Use system default theme",description:"Change the theme of the site to System Default",section:"Theme",handler:()=>{setThemeSetting("system")}}];</script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>