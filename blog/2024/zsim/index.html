<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> zSim + Swarm | uv-xiao </title> <meta name="author" content="Youwei Xiao"> <meta name="description" content="note down some tries, thoughts, and questions about zSim and Swarm"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-table@1.22.4/dist/bootstrap-table.min.css" integrity="sha256-uRX+PiRTR4ysKFRCykT8HLuRCub26LgXJZym3Yeom1c=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Indie+Flower:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link defer rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pseudocode@2.4.1/build/pseudocode.min.css" integrity="sha256-VwMV//xgBPDyRFVSOshhRhzJRDyBmIACniLPpeXNUdc=" crossorigin="anonymous"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://uv-xiao.github.io/blog/2024/zsim/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> <link defer rel="stylesheet" type="text/css" href="https://tikzjax.com/v1/fonts.css"> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> uv-xiao </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">Blog </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">zSim + Swarm</h1> <p class="post-meta"> Created in November 18, 2024 </p> <p class="post-tags"> <a href="/blog/2024"> <i class="fa-solid fa-calendar fa-sm"></i> 2024 </a>   ·   <a href="/blog/category/notes"> <i class="fa-solid fa-tag fa-sm"></i> notes</a> </p> </header> <article class="post-content"> <div id="table-of-contents"> <ul id="toc" class="section-nav"> <li class="toc-entry toc-h1"> <a href="#zsim">zSim</a> <ul> <li class="toc-entry toc-h2"> <a href="#basics">Basics</a> <ul> <li class="toc-entry toc-h3"><a href="#motivation">Motivation</a></li> <li class="toc-entry toc-h3"> <a href="#concepts">Concepts</a> <ul> <li class="toc-entry toc-h4"><a href="#bound-weave-parallelization">Bound-Weave Parallelization</a></li> <li class="toc-entry toc-h4"><a href="#problems">Problems</a></li> </ul> </li> <li class="toc-entry toc-h3"><a href="#organization">Organization</a></li> <li class="toc-entry toc-h3"><a href="#core-model">Core Model</a></li> <li class="toc-entry toc-h3"> <a href="#diving-into-code">Diving into Code</a> <ul> <li class="toc-entry toc-h4"><a href="#core-interface">Core Interface</a></li> <li class="toc-entry toc-h4"><a href="#ooo-core-model">OOO Core Model</a></li> <li class="toc-entry toc-h4"><a href="#ooo-simulation-details">OOO Simulation Details</a></li> </ul> </li> </ul> </li> <li class="toc-entry toc-h2"><a href="#case-study-tartan">Case study: Tartan</a></li> </ul> </li> <li class="toc-entry toc-h1"><a href="#swarm">Swarm</a></li> </ul> </div> <hr> <div id="markdown-content"> <h1 id="zsim">zSim</h1> <h2 id="basics">Basics</h2> <blockquote> <p>reference: <a href="https://zsim.csail.mit.edu/tutorial/" rel="external nofollow noopener" target="_blank">micro48-tutorial</a>, <a href="https://dl.acm.org/doi/10.1145/2508148.2485963" rel="external nofollow noopener" target="_blank">zsim-isca-paper</a></p> </blockquote> <h3 id="motivation">Motivation</h3> <blockquote> <p>why not use gem5? why not FPGA?</p> </blockquote> <ul> <li>speed: gem5 ~200(?, to be verified) KIPS v.s. zsim 10s-1000s MIPS</li> <li>ease of use: compared to FPGA emulation</li> </ul> <h3 id="concepts">Concepts</h3> <ul> <li>Cycle/event-driven: simulate all stages cycle by cycle</li> <li> <p>Instruction-driven: simulate all stages at once per ins/uop, accelerated by DBT</p> </li> <li>gem5: full event-driven emulation</li> <li>zsim: DBT-based instruction-driven core + event-driven uncore</li> </ul> <p>Dynamic Binary Translation (DBT) by <a href="https://software.intel.com/sites/landingpage/pintool/docs/98484/Pin/html/index.html" rel="external nofollow noopener" target="_blank">Intel Pin</a> provides <strong>free functional model</strong>.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/in_posts/2024-11-18-zsim-overview-480.webp 480w,/assets/img/in_posts/2024-11-18-zsim-overview-800.webp 800w,/assets/img/in_posts/2024-11-18-zsim-overview-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/in_posts/2024-11-18-zsim-overview.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> zsim overview </div> <h4 id="bound-weave-parallelization">Bound-Weave Parallelization</h4> <blockquote class="block-warning"> <p>not dived into this yet.</p> </blockquote> <h4 id="problems">Problems</h4> <ul> <li>ZSim doesn’t simulate wrong path execution <ul> <li>of course it matters, but to what extent?</li> <li>potential solution: https://heirman.net/papers/ispass2023wrongpath.pdf</li> </ul> </li> <li>ZSim does badly for systems or workloads with frequent path-altering interference (e.g., fine-grained message-passing across whole chip) <ul> <li>does it matter for CGRA-like systems?</li> </ul> </li> </ul> <h3 id="organization">Organization</h3> <p><code class="language-plaintext highlighter-rouge">libzsim.so</code> (pintool) + <code class="language-plaintext highlighter-rouge">zsim</code> (harness)</p> <pre><code class="language-mermaid">graph LR
  A[Global Memory] &lt;--&gt; zsim
  zsim --&gt; B[pin -t libzsim.so -- &lt;command0&gt;]
  zsim --&gt; C[pin -t libzsim.so -- &lt;command1&gt;]
  B &lt;--&gt; A
  C &lt;--&gt; A
</code></pre> <p>All simulator objects must be allocated in the global heap. Global heap and <code class="language-plaintext highlighter-rouge">libzsim.so</code> code in same memory locations across all processes — Can use normal pointers &amp; virtual functions.</p> <div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">SimObject</span> <span class="o">:</span> <span class="n">GlobAlloc</span> <span class="p">{...}</span>
<span class="n">g_vector</span><span class="o">&lt;</span><span class="kt">uint64_t</span><span class="o">&gt;</span> <span class="n">cacheLines</span><span class="p">;</span>
</code></pre></div></div> <h3 id="core-model">Core Model</h3> <p>DBT(Pin) with 4 types of analysis routine to cover program simulation:</p> <ul> <li>Basic block (BBL)</li> <li>Load and Store</li> <li>Branch</li> </ul> <pre><code class="language-asm">mov (%rbp),%rcx
Load(%rbp) # Load(Address addr) {L1D-&gt;load(addr);}
add %rax,%rbx
mov %rdx,(%rbp)
Store(%rbp) # Store(Address addr) {L1D-&gt;store(addr, val);}
BasicBlock (BblDescriptor {numInst=4,numBytes=4,uops{type,src,dst,lat,fu-port}})
ja 40530a 
</code></pre> <div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">BasicBlock</span><span class="p">(</span><span class="n">BblDescriptor</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">foreach</span> <span class="n">uop</span> <span class="p">{</span>
    <span class="c1">// undergo all stages as the figure below shows</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/in_posts/2024-11-18-zsim-core-model-480.webp 480w,/assets/img/in_posts/2024-11-18-zsim-core-model-800.webp 800w,/assets/img/in_posts/2024-11-18-zsim-core-model-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/in_posts/2024-11-18-zsim-core-model.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> zsim OOO core model for every instruction </div> <blockquote> <p>Memory model things will be discussed in “Diving into Code”</p> </blockquote> <h3 id="diving-into-code">Diving into Code</h3> <p>I create a <a href="https://github.com/uv-xiao/zswarm" rel="external nofollow noopener" target="_blank">fork</a>, which includes docker setup for zsim. Code lines in this section are relative to the <a href="https://github.com/uv-xiao/zsim/commit/1d15beaaa521358cfc26e7c6109e07f182a28053" rel="external nofollow noopener" target="_blank">commit</a>.</p> <blockquote> <p>Acknowlegdement: I borrow the docker setup from <a href="https://github.com/cmu-roboarch/tartan" rel="external nofollow noopener" target="_blank">tartan</a>. I learned much from <a href="https://wangziqi2013.github.io/article/2020/01/01/zsim-microarch.html" rel="external nofollow noopener" target="_blank">microarch-in-zsim</a>.</p> </blockquote> <p>Two paths: zSim path and application path.</p> <p>Instructions in the simulated binary (application path) is still executed by the native hardware, except that at certain points, control will be transferred to the simulator (zSim path) by <em>routines</em>. The routines are named “analysis routines”, in which the timing model of zSim is implemented.</p> <p>Related files:</p> <ul> <li> <code class="language-plaintext highlighter-rouge">zsim_harness.cpp</code> Harness code for zSim, including configuration parsing and Pin run launching.</li> <li> <code class="language-plaintext highlighter-rouge">zsim.cpp</code> Instrumentation routines for basic blocks, loads and stores, and branch instructions.</li> <li> <code class="language-plaintext highlighter-rouge">decoder.h</code> Pre-decoding and Decoding stage simulation; Instruction to uop translation; DynBbl, execution port definition; Register dependency definition.</li> <li> <code class="language-plaintext highlighter-rouge">core.h</code> Core interface for analysis routines; Core interface for simulation.</li> <li> <code class="language-plaintext highlighter-rouge">ooo_core.h</code> Out-of-Order core microarchitecture simulation, incluuding instruction fetch, instruction window, reorder buffer, loads and stores, and register file simulation.</li> </ul> <p>For each process from the configuration, such as <code class="language-plaintext highlighter-rouge">process0</code> and <code class="language-plaintext highlighter-rouge">process1</code> in <code class="language-plaintext highlighter-rouge">simple.cfg</code>, the harness (<code class="language-plaintext highlighter-rouge">zsim_harness.cpp</code>) starts a Pin run for simulation (zsim_harness.cpp:233 <code class="language-plaintext highlighter-rouge">LaunchProcess(uint32_t procIdx)</code>). A Pin run looks like this:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/zswarm/pin-2.14-71313-gcc.4.4.7-linux/intel64/bin/pinbin <span class="nt">-follow_execv</span> <span class="nt">-tool_exit_timeout</span> 1 <span class="nt">-ifeellucky</span> <span class="nt">-t</span> /zswarm/zsim/build/opt/libzsim.so <span class="nt">-config</span> /zswarm/zsim/tests/simple.cfg <span class="nt">-outputDir</span> /zswarm/zsim/zrun <span class="nt">-shmid</span> 22 <span class="nt">-traceToFile</span> <span class="nt">-procIdx</span> 1 <span class="nt">--</span> <span class="nb">cat</span> /zswarm/zsim/tests/simple.cfg
</code></pre></div></div> <blockquote class="block-warning"> <p>Debugging features (in <code class="language-plaintext highlighter-rouge">zsim.cpp</code>, zsim.cpp:1490), FFI and Virt (in <code class="language-plaintext highlighter-rouge">zsim.cpp</code>, zsim.cpp:1533, zsim.cpp:1535) need more diving into code.</p> </blockquote> <p>Instrumentation routines of zSim are defined in <code class="language-plaintext highlighter-rouge">zsim.cpp</code>. <code class="language-plaintext highlighter-rouge">GlobSimInfo</code> holds system configuration values, all read-only, set at initialization. zSim registers a call back <code class="language-plaintext highlighter-rouge">Trace()</code> to PIN using library call <code class="language-plaintext highlighter-rouge">TRACE_AddInstrumentFunction()</code>, at zsim.cpp:1538:</p> <div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">TRACE_AddInstrumentFunction</span><span class="p">(</span><span class="n">Trace</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">Trace(TRACE trace, VOID *v)</code> (at zsim.cpp:603) is called every time PIN sees an uninstrumented trace during execution. It specifies how the trace should be instrumented in zSim. Specifically, it iterates through the basic blocks in the trace, decodes each BBL (zsim.cpp:607, decoder.cpp:1300), and inserts a call to <code class="language-plaintext highlighter-rouge">IndirectBasicBlock</code> (zsim.cpp:181, core.h:46, ooo_core.cpp:505) by <code class="language-plaintext highlighter-rouge">BBL_InsertCall()</code>.</p> <blockquote> <p><a href="https://software.intel.com/sites/landingpage/pintool/docs/98484/Pin/html/index.html" rel="external nofollow noopener" target="_blank">Pin Docs</a> says, Pin’s instrumentation is “just in time” (JIT). Instrumentation occurs immediately before a code sequence is executed for the first time. We call this mode of operation <strong>trace instrumentation</strong>… Pin breaks the trace into basic blocks, BBLs. A BBL is a single entrance, single exit sequence of instructions… Trace instrumentation utilizes the TRACE_AddInstrumentFunction API call.</p> </blockquote> <blockquote> <p>Note that basic blocks and traces are recognized by the Pin framework dynamically, meaning that a dynamic basic block (or trace) in Pin may be broken into two smaller basic blocks (traces) if a branch instruction jumps to the middle of the block (trace) in the run time. In this case, each new basic block (trace) will be re-instrumented by calling the instrumentation routine registered to Pin, and the old instrumentation will be discarded.</p> </blockquote> <p>In <code class="language-plaintext highlighter-rouge">Trace(TRACE trace, VOID *v)</code>, zSim also iterates through instructions in the trace, and run <code class="language-plaintext highlighter-rouge">Instruction(ins)</code> (zsim.cpp:616) for instruction instrumentation. <code class="language-plaintext highlighter-rouge">Instruction</code> (zsim.cpp:535) prints the instruction by <code class="language-plaintext highlighter-rouge">PrintIp</code>, and for load/store/condbr instructions, it inserts callbacks including <code class="language-plaintext highlighter-rouge">IndirectLoadSingle</code>, <code class="language-plaintext highlighter-rouge">IndirectStoreSingle</code>, <code class="language-plaintext highlighter-rouge">IndirectPredLoadSingle</code>, <code class="language-plaintext highlighter-rouge">IndirectPredStoreSingle</code>, and <code class="language-plaintext highlighter-rouge">IndirectRecordBranch</code>. Note that if an instruction accesses multiple memory locations, or both loads from and stores into memory, multiple instrumentations will be injected for the same instruction. Load/store callbacks do nothing more than simply logging the address, which serves as the basis of memory system simulation. Condbr callbacks log the target address and branch outcome (taken or not taken) for branch prediction simulation. The callbacks trigger functions stored in <code class="language-plaintext highlighter-rouge">InstrFuncPtrs fPtrs[MAX_THREADS]</code> (at zsim.cpp:170).</p> <p>Unsupported instructions (often implemented by prefixing a special no-op as “magic op”) are also injected in <code class="language-plaintext highlighter-rouge">Instruction()</code> at zsim.cpp:528. It inserts callbacks to <code class="language-plaintext highlighter-rouge">HandleMagicOp</code>(zsim.cpp:1142). In general, <strong>such instruction instrumentation enables more flexible customization</strong>.</p> <blockquote class="block-tip"> <p>Later in the Tartan case study, we will see how magic op is used to implement new instructions.</p> </blockquote> <h4 id="core-interface">Core Interface</h4> <p><code class="language-plaintext highlighter-rouge">core.h</code> defines the core interface for analysis routines.</p> <p><code class="language-plaintext highlighter-rouge">struct BblInfo</code> stores BBL information including size, #ins, uops, and <strong>decoder cycles</strong>. The last two is used for OOO core model only. In <code class="language-plaintext highlighter-rouge">BblInfo* Decoder::decodeBbl(BBL bbl, bool oooDecoding)</code> from <code class="language-plaintext highlighter-rouge">decoder.cpp</code>, Macro-op fusion is tried (decoder.cpp:1332). It models two steps of OOO decoder: pre-decode and decode. The docoding cycles are stored in <code class="language-plaintext highlighter-rouge">bblInfo-&gt;oooBbl[0].uop[i].decCycle</code>. The concrete instruction decoding is done in <code class="language-plaintext highlighter-rouge">Decoder::decodeInstr</code> (decoder.cpp:541), where <code class="language-plaintext highlighter-rouge">emitXXX()</code>s like <code class="language-plaintext highlighter-rouge">emitBasicOp()</code>, are called to emit uops. Every <code class="language-plaintext highlighter-rouge">instr</code> can have 0-2 src regs and 0-2 dst regs, stored in <code class="language-plaintext highlighter-rouge">uop.rs[0/1]</code> and <code class="language-plaintext highlighter-rouge">uop.rd[0/1]</code>. The decoder is shared by all core models.</p> <p><code class="language-plaintext highlighter-rouge">struct InstrFuncPtrs</code> stores analysis routine function pointers. During initialization, each core type creates an instance of <code class="language-plaintext highlighter-rouge">struct InstrFuncPtrs</code>, and populates this structure with its own static member functions. zSim stores the current instance being used in a global structure, <code class="language-plaintext highlighter-rouge">InstrFuncPtrs fPtrs[MAX_THREADS]</code> (at zsim.cpp:170). Here is a field list of <code class="language-plaintext highlighter-rouge">struct InstrFuncPtrs</code>:</p> <table class="mbtablestyle"> <thead> <tr> <th style="text-align: center">Field Name</th> <th>Description</th> <th>Core Method Called (<code class="language-plaintext highlighter-rouge">OOOCore</code>)</th> </tr> </thead> <tbody> <tr> <td style="text-align: center">loadPtr</td> <td>Called before instructions that read from memory for each operand</td> <td><code class="language-plaintext highlighter-rouge">OOOCore::LoadFunc()</code></td> </tr> <tr> <td style="text-align: center">storePtr</td> <td>Called before instructions that write into memory for each operand</td> <td><code class="language-plaintext highlighter-rouge">OOOCore::StoreFunc()</code></td> </tr> <tr> <td style="text-align: center">bblPtr</td> <td>Called before a basic block is about to be executed</td> <td><code class="language-plaintext highlighter-rouge">OOOCore::BblFunc()</code></td> </tr> <tr> <td style="text-align: center">branchPtr</td> <td>Called before control flow instructions, including conditional and unconditional branches</td> <td><code class="language-plaintext highlighter-rouge">OOOCore::BranchFunc()</code></td> </tr> <tr> <td style="text-align: center">predLoadPtr</td> <td>Called before predicated load instructions for each operand</td> <td><code class="language-plaintext highlighter-rouge">OOOCore::PredLoadFunc()</code></td> </tr> <tr> <td style="text-align: center">predStorePtr</td> <td>Called before predicated store instructions for each operand</td> <td><code class="language-plaintext highlighter-rouge">OOOCore::PredStoreFunc()</code></td> </tr> </tbody> </table> <h4 id="ooo-core-model">OOO Core Model</h4> <p>We first describe the behavior of analysis routines in <code class="language-plaintext highlighter-rouge">OOOCore</code>. <code class="language-plaintext highlighter-rouge">OOOCore::LoadFunc()</code> and <code class="language-plaintext highlighter-rouge">OOOCore::StoreFunc()</code> call <code class="language-plaintext highlighter-rouge">OOOCore::load()</code> and <code class="language-plaintext highlighter-rouge">OOOCore::store()</code> respectively, which log the memory access address into an array, <code class="language-plaintext highlighter-rouge">loadAddrs</code> and <code class="language-plaintext highlighter-rouge">storeAddrs</code>. These addresses will be used for cache system simulation after the current basic block has finished execution. Similarly, <code class="language-plaintext highlighter-rouge">OOOCore::PredLoadFunc()</code> and <code class="language-plaintext highlighter-rouge">OOOCore::PredStoreFunc()</code> log the addresses of predicated memory accesses if the condition evaluates to true, or -1 if false. <code class="language-plaintext highlighter-rouge">OOOCore::BranchFunc()</code> log the branch outcome, the taken and not taken address, and the address of the branch instruction itself by setting fields <code class="language-plaintext highlighter-rouge">branchTaken</code>, <code class="language-plaintext highlighter-rouge">branchTakenNpc</code>, <code class="language-plaintext highlighter-rouge">branchNotTakenNpc</code> and <code class="language-plaintext highlighter-rouge">branchPc</code>. Only one entry for branch logging is required, since according to the definition, branches will only occur as the last instruction of a basic block.</p> <p><code class="language-plaintext highlighter-rouge">class OOOCore</code> is defined in <code class="language-plaintext highlighter-rouge">ooo_core.h</code> (at ooo_core.h:361).</p> <h4 id="ooo-simulation-details">OOO Simulation Details</h4> <blockquote> <p>One extremely useful resource of microarchitectural documents is <a href="https://www.agner.org/optimize/" rel="external nofollow noopener" target="_blank">Agner’s Blog</a>, in which the structure of the pipeline and micro-op (uop) maps are described in detail. zSim also uses materials in this blog as a reference. Especially, it includes the <a href="microarchitecture">microarchitecture manual</a> and the <a href="https://www.agner.org/optimize/instruction_tables.pdf" rel="external nofollow noopener" target="_blank">instruction table</a> (also a <a href="https://www.agner.org/optimize/instruction_tables.ods" rel="external nofollow noopener" target="_blank">ods spreadsheet</a>).</p> </blockquote> <blockquote class="block-warning"> <p>todo</p> </blockquote> <h2 id="case-study-tartan">Case study: Tartan</h2> <blockquote class="block-warning"> <p>todo</p> </blockquote> <h1 id="swarm">Swarm</h1> <blockquote class="block-warning"> <p>todo</p> </blockquote> </div> </article> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2024 Youwei Xiao. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Last updated: December 20, 2024. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/mermaid@10.7.0/dist/mermaid.min.js" integrity="sha256-TtLOdUA8mstPoO6sGvHIGx2ceXrrX4KgIItO06XOn8A=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/d3@7.8.5/dist/d3.min.js" integrity="sha256-1rA678n2xEx7x4cTZ5x4wpUCj6kUMZEZ5cxLSVSFWxw=" crossorigin="anonymous"></script> <script>let mermaidTheme=determineComputedTheme();document.addEventListener("readystatechange",()=>{"complete"===document.readyState&&(document.querySelectorAll("pre>code.language-mermaid").forEach(e=>{const t=e.textContent,d=e.parentElement;d.classList.add("unloaded");let a=document.createElement("pre");a.classList.add("mermaid");const n=document.createTextNode(t);a.appendChild(n),d.after(a)}),mermaid.initialize({theme:mermaidTheme}),"undefined"!=typeof d3&&window.addEventListener("load",function(){d3.selectAll(".mermaid svg").each(function(){var e=d3.select(this);e.html("<g>"+e.html()+"</g>");var t=e.select("g"),d=d3.zoom().on("zoom",function(e){t.attr("transform",e.transform)});e.call(d)})}))});</script> <script defer src="https://tikzjax.com/v1/tikzjax.js" integrity="sha256-+1qyucCXRZJrCg3lm3KxRt/7WXaYhBid4/1XJRHGB1E=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script defer src="https://cdn.jsdelivr.net/npm/bootstrap-table@1.22.4/dist/bootstrap-table.min.js" integrity="sha256-4rppopQE9POKfukn2kEvhJ9Um25Cf6+IDVkARD0xh78=" crossorigin="anonymous"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0,processEnvironments:!0}};</script> <script type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/pseudocode@2.4.1/build/pseudocode.min.js" integrity="sha256-aVkDxqyzrB+ExUsOY9PdyelkDhn/DfrjWu08aVpqNlo=" crossorigin="anonymous"></script> <script>document.addEventListener("readystatechange",()=>{"complete"===document.readyState&&document.querySelectorAll("pre>code.language-pseudocode").forEach(e=>{const t=e.textContent,d=e.parentElement.parentElement;let n=document.createElement("pre");n.classList.add("pseudocode");const o=document.createTextNode(t);n.appendChild(o),d.appendChild(n),d.removeChild(e.parentElement),pseudocode.renderElement(n)})});</script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> <script src="/assets/js/tabs.min.js?b8748955e1076bbe0dabcf28f2549fdc"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>addBackToTop();</script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script>let searchTheme=determineComputedTheme();const ninjaKeys=document.querySelector("ninja-keys");"dark"===searchTheme?ninjaKeys.classList.add("dark"):ninjaKeys.classList.remove("dark");const openSearchModal=()=>{const e=$("#navbarNav");e.hasClass("show")&&e.collapse("hide"),ninjaKeys.open()};</script> <script>const ninja=document.querySelector("ninja-keys");ninja.data=[{id:"nav-about",title:"About",section:"Navigation",handler:()=>{window.location.href="/"}},{id:"nav-blog",title:"Blog",description:"",section:"Navigation",handler:()=>{window.location.href="/blog/"}},{id:"post-use-babble-for-egglog",title:"use babble for egglog",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/egglog-babble/"}},{id:"post-look-into-eggcc",title:"Look into eggcc",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/eggcc/"}},{id:"post-learn-e-graph-egg-and-more",title:"Learn e-graph, egg, and more",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2024/egg-things/"}},{id:"post-zsim-swarm",title:"zSim + Swarm",description:"note down some tries, thoughts, and questions about zSim and Swarm",section:"Posts",handler:()=>{window.location.href="/blog/2024/zsim/"}},{id:"post-supported-features",title:"Supported Features",description:"this is what features are supported in posts",section:"Posts",handler:()=>{window.location.href="/blog/2024/features/"}},{id:"socials-email",title:"Send email",section:"Socials",handler:()=>{window.open("mailto:%73%68%61%6C%6C%77%65%78%69%61%6F@%67%6D%61%69%6C.%63%6F%6D","_blank")}},{id:"socials-github",title:"GitHub",section:"Socials",handler:()=>{window.open("https://github.com/uv-xiao","_blank")}},{id:"socials-x",title:"X",description:"Twitter",section:"Socials",handler:()=>{window.open("https://twitter.com/youwei_xiao","_blank")}},{id:"socials-rss",title:"RSS Feed",section:"Socials",handler:()=>{window.open("/feed.xml","_blank")}},{id:"light-theme",title:"Change theme to light",description:"Change the theme of the site to Light",section:"Theme",handler:()=>{setThemeSetting("light")}},{id:"dark-theme",title:"Change theme to dark",description:"Change the theme of the site to Dark",section:"Theme",handler:()=>{setThemeSetting("dark")}},{id:"system-theme",title:"Use system default theme",description:"Change the theme of the site to System Default",section:"Theme",handler:()=>{setThemeSetting("system")}}];</script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>